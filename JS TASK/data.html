<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <header>
    <h1>Expense Tracker</h1>
  </header>

  <main>
    <section>
      <h2 style="text-align: center;">Add New Expense</h2>
      <form id="expense-form" style="width: 30%; margin: auto;">
        <label for="expense-name">Expense Name</label>
        <input type="text" id="expense-name" name="expense-name" required>

        <label for="expense-category">Category</label>
        <select id="expense-category" name="category" required>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Bills">Bills</option>
          <option value="Other">Other</option>
        </select>

        <label for="expense-amount">Amount</label>
        <input type="number" id="expense-amount" name="amount" required>

        <button type="submit" style="width: 250px; justify-content: center; margin: auto; display: flex; margin-top: 30px;">Add Expense</button>
      </form>
    </section>

    <section>
      <h2>Expense List</h2>
      
      <!-- Filter Section for Price -->
      <div style="text-align: center;">
        <label for="min-price">Min Price: </label>
        <input type="number" id="min-price" placeholder="Min Price" style="width: 100px;">

        <label for="max-price" style="margin-left: 10px;">Max Price: </label>
        <input type="number" id="max-price" placeholder="Max Price" style="width: 100px;">

        <button id="filter-btn" style="margin-left: 10px;">Filter by Price</button>
      </div>

      <ul id="expense-list">
        <!-- Expense list will be populated dynamically using JavaScript -->
      </ul>
    </section>
  </main>

  <footer style="margin-top: 350px;">
    <p style="text-align: center;">&copy; 2025 Expense Tracker</p>
  </footer>

  <script>
    const expenseForm = document.getElementById('expense-form');
    const expenseList = document.getElementById('expense-list');
    const minPriceInput = document.getElementById('min-price');
    const maxPriceInput = document.getElementById('max-price');
    const filterButton = document.getElementById('filter-btn');

    // Replace with your actual API URL
    const API_URL = 'http://localhost:3000/expenses';

    let expenses = [];  // Store expenses in an array for filtering

    // Fetch expenses for the user
    function fetchExpenses() {
      fetch(API_URL)
        .then(response => response.json())
        .then(data => {
          expenses = data;  // Store fetched expenses
          renderExpenses(); // Render expenses initially
        })
        .catch(error => console.error('Error fetching expenses:', error));
    }

    // Render the list of expenses
    function renderExpenses() {
      expenseList.innerHTML = ''; // Clear the list before rendering
      const filteredExpenses = filterExpensesByPrice();
      filteredExpenses.forEach(expense => {
        const expenseItem = document.createElement('li');
        expenseItem.textContent = `${expense.name} - ${expense.category} - $${expense.amount}`;
        expenseList.appendChild(expenseItem);
      });
    }

    // Filter expenses based on price range (min and max)
    function filterExpensesByPrice() {
      const minPrice = parseFloat(minPriceInput.value) || 0;  // Default to 0 if no min price is entered
      const maxPrice = parseFloat(maxPriceInput.value) || Infinity; // Default to Infinity if no max price is entered

      return expenses.filter(expense => expense.amount >= minPrice && expense.amount <= maxPrice);
    }

    // Handle the expense form submission
    expenseForm.addEventListener('submit', function (e) {
      e.preventDefault(); // Prevent default form submission

      // Get form data
      const expenseName = document.getElementById('expense-name').value;
      const category = document.getElementById('expense-category').value;
      const amount = document.getElementById('expense-amount').value;

      // Validate fields
      if (!expenseName || !category || !amount) {
        alert('All fields are required!');
        return;
      }

      // Send expense data to the API (POST request)
      fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: expenseName,
          category: category,
          amount: amount
        })
      })
      .then(response => response.json())
      .then(() => {
        fetchExpenses(); // Fetch updated list of expenses
        expenseForm.reset(); // Reset form after submission
      })
      .catch(error => console.error('Error adding expense:', error));
    });

    // Event listener for the filter button
    filterButton.addEventListener('click', renderExpenses);

    // Fetch expenses when the page loads
    window.onload = fetchExpenses;
  </script>
</body>
</html>
